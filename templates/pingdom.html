<!DOCTYPE html>
<html>
<head>
    <title>{{.Title}}</title>
    <link rel="stylesheet" type="text/css" href="css/styles.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
    <meta http-equiv="refresh" content="300">
</head>
<body>
    <header>
        <nav>
            <ul>
                <li><a href="/" class="rounded-box">Home</a></li>
                <li><a href="/incidents" class="rounded-box">Time between incidents</a></li>
                <li><a href="/pingdom" class="selected rounded-box">Availability report</a></li>
                <li><a href="/toil" class="rounded-box">Toil numbers</a></li>
            </ul>
        </nav>
        <h1>{{.Title}}</h1>
    </header>

    <div class="center-div">
        <h2>Uptime from the last 2 weeks in Pingdom</h2>
        <div class="results-table clearfix">
            <div class="avg-diff rounded-box">
                <h3>CWP Total uptime: {{.CwpUptime}}</h3>
                <p>SLA 99.7%</p>
                {{ if .CwpDiff}}
                    {{ if .CwpIncrease }}
                        <p class="good">Increased by {{.CwpDiff}}%</p>
                    {{ else }}
                        <p class="bad">Decreased by {{.CwpDiff}}%</p>
                    {{ end }}
                {{ end }}
            </div>
            <table class="full-width availability-table rounded-box">
                <tr>
                    <th>Availability</th>
                    <th class="left">Check</th>
                    <th class="right">Downtime</th>
                    <th class="right">Error budget</th>
                </tr>
            {{ $cwpLength := len .CwpRes }}
            {{ $rowLength := len .CwpRowCount }}
            {{range $idx, $e := .CwpRowCount}}{{with $n := index $.CwpRes $idx}}
                <tr>
                    <td>{{$n.Availability}}%</td>
                    <td class="left">{{substr $n.Name 25}}</td>
                    <td class="right">{{$n.Downtime}}</td>
                    {{ if .IsMinus }}
                        <td class="bad right">{{$n.ErrorBudget}}</td>
                    {{ else }}
                        <td class="warning right">{{$n.ErrorBudget}}</td>
                    {{ end }}
                </tr>
            {{ end }}{{ end }}
            </table>
            {{ $rowLength := len .CwpRowCount }}{{ if gt $cwpLength $rowLength}}
                <table class="full-width availability-table rounded-box">
                    <tr>
                        <th>Availability</th>
                        <th class="left">Check</th>
                        <th class="right">Downtime</th>
                        <th class="right">Error budget</th>
                    </tr>
                {{range $idx, $e := .CwpRowCount}}{{ $idx = add $idx $rowLength }}{{with $n := index $.CwpRes $idx}}
                    <tr>
                        <td>{{$n.Availability}}%</td>
                        <td class="left">{{substr $n.Name 22}}</td>
                        <td class="right">{{$n.Downtime}}</td>
                        {{ if .IsMinus }}
                            <td class="bad right">{{$n.ErrorBudget}}</td>
                        {{ else }}
                            <td class="warning right">{{$n.ErrorBudget}}</td>
                        {{ end }}
                    </tr>
                {{ end }}{{ end }}
                </table>
            {{ end }}
            {{ $doubleLength := times 2 $rowLength }}
            {{ if gt $cwpLength $doubleLength}}
                <table class="full-width availability-table rounded-box">
                    <tr>
                        <th>Availability</th>
                        <th class="left">Check</th>
                        <th class="right">Downtime</th>
                        <th class="right">Error budget</th>
                    </tr>
                {{range $idx, $e := .CwpRowCount}}{{ $idx = add $idx $doubleLength }}{{with $n := index $.CwpRes $idx}}
                    <tr>
                        <td>{{$n.Availability}}%</td>
                        <td class="left">{{substr $n.Name 22}}</td>
                        <td class="right">{{$n.Downtime}}</td>
                        {{ if .IsMinus }}
                            <td class="bad right">{{$n.ErrorBudget}}</td>
                        {{ else }}
                            <td class="warning right">{{$n.ErrorBudget}}</td>
                        {{ end }}
                    </tr>
                {{ end }}{{ end }}
                </table>
            {{ end }}

        </div>

        <div class="results-table">
            <div class="avg-diff rounded-box">
                <h3>SSP Total uptime: {{.SspUptime}}</h3>
                <p>SLO 99.9%</p>
                {{ if .SspDiff}}
                    {{ if .SspIncrease }}
                        <p class="good">Increased by {{.SspDiff}}%</p>
                    {{ else }}
                        <p class="bad">Decreased by {{.SspDiff}}%</p>
                    {{ end }}
                {{ end }}
            </div>
            <table class="full-width availability-table rounded-box">
                <tr>
                    <th>Availability</th>
                    <th class="left">Check</th>
                    <th class="right">Downtime</th>
                    <th class="right">Error budget</th>
                </tr>
            {{ $sspLength := len .SspRes }}
            {{ $rowLength := len .SspRowCount }}
            {{range $idx, $e := .SspRowCount}}{{with $n := index $.SspRes $idx}}
                <tr>
                    <td>{{$n.Availability}}%</td>
                    <td class="left">{{substr $n.Name 22}}</td>
                    <td class="right">{{$n.Downtime}}</td>
                    {{ if .IsMinus }}
                        <td class="bad right">{{$n.ErrorBudget}}</td>
                    {{ else }}
                        <td class="warning right">{{$n.ErrorBudget}}</td>
                    {{ end }}
                </tr>
            {{ end }}{{ end }}
            </table>
            {{ $rowLength := len .SspRowCount }}{{ if gt $sspLength $rowLength}}
                <table class="full-width availability-table rounded-box">
                    <tr>
                        <th>Availability</th>
                        <th class="left">Check</th>
                        <th class="right">Downtime</th>
                        <th class="right">Error budget</th>
                    </tr>
                {{range $idx, $e := .SspRowCount}}{{ $idx = add $idx $rowLength }}{{with $n := index $.SspRes $idx}}
                    <tr>
                        <td>{{$n.Availability}}%</td>
                        <td class="left">{{substr $n.Name 22}}</td>
                        <td class="right">{{$n.Downtime}}</td>
                        {{ if .IsMinus }}
                            <td class="bad right">{{$n.ErrorBudget}}</td>
                        {{ else }}
                            <td class="warning right">{{$n.ErrorBudget}}</td>
                        {{ end }}
                    </tr>
                {{ end }}{{ end }}
                </table>
            {{ end }}
            {{ $doubleLength := times 2 $rowLength }}
            {{ if gt $sspLength $doubleLength}}
                <table class="full-width availability-table rounded-box">
                    <tr>
                        <th>Availability</th>
                        <th class="left">Check</th>
                        <th class="right">Downtime</th>
                        <th class="right">Error budget</th>
                    </tr>
                {{range $idx, $e := .SspRowCount}}{{ $idx = add $idx $doubleLength }}{{with $n := index $.SspRes $idx}}
                    <tr>
                        <td>{{$n.Availability}}%</td>
                        <td class="left">{{substr $n.Name 22}}</td>
                        <td class="right">{{$n.Downtime}}</td>
                        {{ if .IsMinus }}
                            <td class="bad right">{{$n.ErrorBudget}}</td>
                        {{ else }}
                            <td class="warning right">{{$n.ErrorBudget}}</td>
                        {{ end }}
                    </tr>
                {{ end }}{{ end }}
                </table>
            {{ end }}
        </div>
    </div>
</body>
</html>

